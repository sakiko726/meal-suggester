import streamlit as st
from datetime import datetime, timedelta

st.title("AIã‚³ãƒ¼ãƒä»˜ã é£Ÿäº‹ & ä½“èª¿ã‚µãƒãƒ¼ãƒˆã‚¢ãƒ—ãƒª ğŸ’›")

# =========================================================
# ğŸ©¸ 1) ç”Ÿç†å‘¨æœŸåˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
# =========================================================
st.header("ğŸ©¸ ç”Ÿç†å‘¨æœŸãƒã‚§ãƒƒã‚¯")

period_start = st.date_input("ç›´è¿‘ã®ç”Ÿç†é–‹å§‹æ—¥ã‚’å…¥åŠ›ã—ã¦ã­")
cycle_length = st.number_input("å¹³å‡ç”Ÿç†å‘¨æœŸï¼ˆæ—¥ï¼‰", min_value=20, max_value=40, value=28)
period_length = st.number_input("ç”Ÿç†æœŸé–“ã®æ—¥æ•°", min_value=3, max_value=10, value=5)

today = datetime.now().date()

phase = "ä¸æ˜"
coach_msg = ""

if period_start:
    days_passed = (today - period_start).days % cycle_length

    if days_passed < period_length:
        phase = "æœˆçµŒæœŸï¼ˆMenstruationï¼‰"
        coach_msg = "ä»Šæ—¥ã¯ã‚†ã£ãã‚Šä¼‘ã‚“ã§ã­â€¦ç”Ÿãã¦ã‚‹ã ã‘ã§å‰ã„ã‚ˆğŸ’›"

    elif days_passed < 14:
        phase = "åµèƒæœŸï¼ˆFollicularï¼‰"
        coach_msg = "ä»£è¬ãŒä¸ŠãŒã‚Šã‚„ã™ã„æ™‚æœŸï¼ã“ã“ã‹ã‚‰ä¸€ç·’ã«ãƒšãƒ¼ã‚¹ä¸Šã’ã‚ˆğŸ’›"

    elif days_passed == 14:
        phase = "æ’åµæœŸï¼ˆOvulationï¼‰"
        coach_msg = "é­…åŠ›MAXã®æ™‚æœŸâœ¨ æ°—åˆ†ã‚‚è‚Œã‚‚èª¿å­ã‚ˆããªã‚ŠãŒã¡ï¼"

    else:
        phase = "é»„ä½“æœŸï¼ˆLutealï¼‰"
        coach_msg = "ã‚€ãã¿ãƒ»é£Ÿæ¬²UPã—ãŒã¡ï¼ç”˜ã„ç‰©ã»ã—ããªã‚‹ã®ã¯ãƒ›ãƒ«ãƒ¢ãƒ³ã®ã›ã„ğŸ«"

    st.subheader(f"ğŸ“Œ ç¾åœ¨ã®ã‚ãªãŸã®ãƒ•ã‚§ãƒ¼ã‚ºï¼š **{phase}**")
    st.write(coach_msg)


# =========================================================
# ğŸ¤– 2) ã‚³ãƒ¼ãƒé¸æŠ
# =========================================================
st.header("ğŸ¤– ã‚³ãƒ¼ãƒé¸æŠ")
coach = st.selectbox(
    "ã‚³ãƒ¼ãƒã‚’é¸ã‚“ã§ã­ï¼",
    ["å„ªã—ã„ãŠå§‰ã•ã‚“ğŸ’›", "å³ã—ã‚ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ¼ğŸ’ª", "å†·é™ãªåŒ»è€…ğŸ‘“"],
)


# =========================================================
# ğŸš 3) é£Ÿæãƒ‡ãƒ¼ã‚¿ï¼ˆè¾æ›¸å½¢å¼ æ­£ã—ã„å½¢ï¼‰
# =========================================================
FOODS = {
    "ç™½ã”ã¯ã‚“": {"kcal": 168},
    "ã‚ªãƒ¼ãƒˆãƒŸãƒ¼ãƒ«": {"kcal": 380},
    "é£Ÿãƒ‘ãƒ³": {"kcal": 260},
    "ã†ã©ã‚“": {"kcal": 105},
    "ãã°": {"kcal": 120},

    "é¶ã‚€ã­è‚‰": {"kcal": 165},
    "é¶ã•ã•ã¿": {"kcal": 105},
    "ç‰›èµ¤èº«": {"kcal": 182},
    "è±šãƒ­ãƒ¼ã‚¹": {"kcal": 240},
    "ã‚µãƒ¼ãƒ¢ãƒ³": {"kcal": 200},
    "ãƒ„ãƒŠç¼¶ï¼ˆæ°´ç…®ï¼‰": {"kcal": 102},

    "åµ": {"kcal": 151},
    "è±†è…": {"kcal": 56},
    "ç´è±†": {"kcal": 200},
    "åšæšã’": {"kcal": 150},

    "ãƒ–ãƒ­ãƒƒã‚³ãƒªãƒ¼": {"kcal": 33},
    "ãƒˆãƒãƒˆ": {"kcal": 18},
    "ãƒ¬ã‚¿ã‚¹": {"kcal": 15},
    "ã«ã‚“ã˜ã‚“": {"kcal": 37},
    "ã»ã†ã‚Œã‚“è‰": {"kcal": 20},

    "ãƒãƒŠãƒŠ": {"kcal": 86},
    "ã‚Šã‚“ã”": {"kcal": 52},
    "ã„ã¡ã”": {"kcal": 34},
    "ã¿ã‹ã‚“": {"kcal": 45},

    "ãƒ¨ãƒ¼ã‚°ãƒ«ãƒˆ": {"kcal": 62},
    "ãƒãƒ¼ã‚º": {"kcal": 356},
    "ãƒŠãƒƒãƒ„": {"kcal": 600},
    "ã‚¢ãƒœã‚«ãƒ‰": {"kcal": 187},

    "ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ": {"kcal": 558},
    "ã‚¢ã‚¤ã‚¹": {"kcal": 180},
    "ã‚¯ãƒƒã‚­ãƒ¼": {"kcal": 490},
    "ã‚±ãƒ¼ã‚­": {"kcal": 430},
}

food_names = list(FOODS.keys())


# =========================================================
# ğŸ½ 4) é£Ÿäº‹å…¥åŠ›
# =========================================================
st.header("ğŸ½ é£Ÿäº‹å…¥åŠ›ï¼ˆã‚°ãƒ©ãƒ ã§OKï¼ï¼‰")

selected_food = st.selectbox("é£Ÿã¹ãŸã‚‚ã®ã‚’é¸ã¶", food_names)
grams = st.number_input("é£Ÿã¹ãŸé‡ï¼ˆgï¼‰", min_value=1, max_value=2000, value=100)

if st.button("ã‚«ãƒ­ãƒªãƒ¼è¨ˆç®—"):
    kcal_per_100g = FOODS[selected_food]["kcal"]
    total_kcal = kcal_per_100g * grams / 100

    st.subheader(f"ğŸ‘‰ **{selected_food}ï¼š{total_kcal:.1f} kcal**")

    # ç°¡æ˜“ã‚¢ãƒ‰ãƒã‚¤ã‚¹
    if kcal_per_100g < 50:
        nutrient_need = "é£Ÿç‰©ç¹Šç¶­ãŒå¤šã‚ï¼è…¸ã«ã‚„ã•ã—ã„ã­ğŸŒ¿"
        suggestion = "ã‚¿ãƒ³ãƒ‘ã‚¯è³ªæºï¼ˆé¶è‚‰ãƒ»åµï¼‰ã‚’è¿½åŠ ã—ã‚ˆã†ï¼"
    elif kcal_per_100g < 200:
        nutrient_need = "ãƒãƒ©ãƒ³ã‚¹ã®è‰¯ã„é£Ÿæã ã‚ˆğŸ‘Œ"
        suggestion = "é‡èœã‚’è¶³ã™ã¨ã•ã‚‰ã«å®Œç’§ï¼"
    else:
        nutrient_need = "è„‚è³ªãƒ»ç³–è³ªãŒå¤šã‚ã‹ã‚‚ğŸ°"
        suggestion = "æ¬¡ã®é£Ÿäº‹ã¯è»½ã‚ or ã‚¿ãƒ³ãƒ‘ã‚¯è³ªå¤šã‚ã«âœ¨"

    st.write("### ğŸ” æ „é¤Šåˆ†æ")
    st.write(nutrient_need)

    st.write("### ğŸ½ æ¬¡ã®é£Ÿäº‹ã®ãŠã™ã™ã‚")
    st.write(suggestion)

    # ã‚³ãƒ¼ãƒã‚³ãƒ¡ãƒ³ãƒˆ
    st.write("---")
    st.subheader("ğŸ¤– ä»Šæ—¥ã®ã‚³ãƒ¼ãƒã‚³ãƒ¡ãƒ³ãƒˆ")

    if coach == "å„ªã—ã„ãŠå§‰ã•ã‚“ğŸ’›":
        st.write("ğŸ’› ã‚ˆãé£Ÿã¹ãŸã­ã€œï¼ãã®èª¿å­ã§ç„¡ç†ãªãç¶šã‘ã‚ˆï¼")
    elif coach == "å³ã—ã‚ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ¼ğŸ’ª":
        st.write("ğŸ’ª ã¾ã ã„ã‘ã‚‹ï¼ã‚¿ãƒ³ãƒ‘ã‚¯è³ªè¿½åŠ ã—ã¦ã„ã“ã†ï¼ï¼")
    else:
        st.write("ğŸ‘“ ãµã‚€ã€ãƒ‡ãƒ¼ã‚¿ã¯è‰¯å¥½ã§ã™ã­ã€‚æ¬¡ã¯PFCãƒãƒ©ãƒ³ã‚¹ã‚‚è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚")


# =========================================================
# âš™ï¸ 5) ã‚µã‚¤ãƒ‰ãƒãƒ¼è¨­å®š
# =========================================================
with st.sidebar:
    st.header("âš™ï¸ è¨­å®š")
    st.write("ã“ã“ã§ç›®æ¨™å€¤ã‚’å¤‰ãˆã‚‰ã‚Œã‚‹ã‚ˆï¼")

    if "settings" not in st.session_state:
        st.session_state.settings = {
            "kcal_target": 1450,
            "protein_target": 100,
            "fat_target": 35,
            "carbs_target": 160,
            "coach_tone": "å„ªã—ã„ãŠå§‰ã•ã‚“",
            "hormone_phase": "ãªã—"
        }

    s = st.session_state.settings

    s["kcal_target"] = st.number_input("ç›®æ¨™ kcal", value=s["kcal_target"])
    s["protein_target"] = st.number_input("ç›®æ¨™ P", value=s["protein_target"])
    s["fat_target"] = st.number_input("ç›®æ¨™ F", value=s["fat_target"])
    s["carbs_target"] = st.number_input("ç›®æ¨™ C", value=s["carbs_target"])

    st.markdown("### ğŸ©º ç”Ÿç†å‘¨æœŸ")
    s["hormone_phase"] = st.selectbox("ãƒ›ãƒ«ãƒ¢ãƒ³çŠ¶æ…‹", ["ãªã—", "æœˆçµŒ", "åµèƒæœŸ", "æ’åµæœŸ", "é»„ä½“æœŸ"])

    st.markdown("### ğŸ¤ ã‚³ãƒ¼ãƒã®ã‚¿ã‚¤ãƒ—")
    s["coach_tone"] = st.selectbox("ã‚³ãƒ¼ãƒã®å£èª¿", ["å„ªã—ã„ãŠå§‰ã•ã‚“", "å³ã—ã‚ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ¼", "åŒ»è€…"])

