import streamlit as st
from datetime import datetime, timedelta

st.title("AIã‚³ãƒ¼ãƒä»˜ã é£Ÿäº‹ & ä½“èª¿ã‚µãƒãƒ¼ãƒˆã‚¢ãƒ—ãƒª ğŸ’›")

# -------------------------
# ğŸ”¥ ç”Ÿç†å‘¨æœŸåˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
# -------------------------

st.header("ğŸ©¸ ç”Ÿç†å‘¨æœŸãƒã‚§ãƒƒã‚¯")

period_start = st.date_input("ç›´è¿‘ã®ç”Ÿç†é–‹å§‹æ—¥ã‚’å…¥åŠ›ã—ã¦ã­")

cycle_length = st.number_input("å¹³å‡ç”Ÿç†å‘¨æœŸï¼ˆæ—¥ï¼‰", min_value=20, max_value=40, value=28)
period_length = st.number_input("ç”Ÿç†æœŸé–“ã®æ—¥æ•°", min_value=3, max_value=10, value=5)

today = datetime.now().date()

if period_start:
    days_passed = (today - period_start).days % cycle_length

    if days_passed < period_length:
        phase = "æœˆçµŒæœŸï¼ˆMenstruationï¼‰"
        coach_msg = "ä»Šæ—¥ã¯ã‚†ã£ãã‚Šä¼‘ã‚“ã§ã­â€¦ç”Ÿãã¦ã‚‹ã ã‘ã§å‰ã„ã‚ˆğŸ’›"
    elif days_passed < 14:
        phase = "åµèƒæœŸï¼ˆFollicularï¼‰"
        coach_msg = "ä»£è¬ãŒä¸ŠãŒã‚Šã‚„ã™ã„æ™‚æœŸï¼ã“ã“ã‹ã‚‰ä¸€ç·’ã«ãƒšãƒ¼ã‚¹ä¸Šã’ã‚ˆğŸ’›"
    elif days_passed == 14:
        phase = "æ’åµæœŸï¼ˆOvulationï¼‰"
        coach_msg = "é­…åŠ›MAXã®æ™‚æœŸã ã‚ˆâœ¨è‚Œã‚‚æ°—åˆ†ã‚‚è‰¯ããªã‚Šã‚„ã™ã„ï¼"
    elif days_passed < cycle_length:
        phase = "é»„ä½“æœŸï¼ˆLutealï¼‰"
        coach_msg = "ã‚€ãã¿ãƒ»é£Ÿæ¬²çˆ†å¢—ã—ãŒã¡ï¼ç”˜ã„ç‰©ã»ã—ããªã‚‹ã®ã¯ãƒ›ãƒ«ãƒ¢ãƒ³ã®ã›ã„ğŸ«"
    else:
        phase = "ä¸æ˜ï¼ˆè¨ˆç®—å¤–ï¼‰"
        coach_msg = "ã‚‚ã†ä¸€åº¦å…¥åŠ›ã—ã¦ã¿ã¦ã­ğŸ‘“"

    st.subheader(f"ğŸ“Œ ç¾åœ¨ã®ã‚ãªãŸã®ãƒ•ã‚§ãƒ¼ã‚ºï¼š**{phase}**")
    st.write(coach_msg)

# -------------------------
# ğŸ”¥ AIã‚³ãƒ¼ãƒé¸æŠ
# -------------------------

st.header("ğŸ¤– ã‚³ãƒ¼ãƒé¸æŠ")
coach = st.selectbox(
    "ã‚³ãƒ¼ãƒã‚’é¸ã‚“ã§ã­ï¼",
    ["å„ªã—ã„ãŠå§‰ã•ã‚“ğŸ’›", "å³ã—ã‚ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ¼ğŸ’ª", "å†·é™ãªåŒ»è€…ğŸ‘“"],
)

# -------------------------
# ğŸ”¥ é£Ÿæãƒ‡ãƒ¼ã‚¿
# -------------------------

food_data = [
    {"name": "ã•ã¤ã¾ã„ã‚‚", "cal": 1.3},
    {"name": "ç™½ã”ã¯ã‚“", "cal": 1.68},
    {"name": "é¶èƒ¸è‚‰", "cal": 1.65},
    {"name": "åµ", "cal": 1.55},
    {"name": "ã‚¢ãƒœã‚«ãƒ‰", "cal": 1.6},
    {"name": "ã‚Šã‚“ã”", "cal": 0.52},
    {"name": "ãƒãƒŠãƒŠ", "cal": 0.86},
    {"name": "ãƒ–ãƒ­ãƒƒã‚³ãƒªãƒ¼", "cal": 0.33},
    {"name": "ãƒˆãƒãƒˆ", "cal": 0.18},
    {"name": "ãƒ¬ã‚¿ã‚¹", "cal": 0.15},
]

names = [f["name"] for f in food_data]

# -------------------------
# ğŸ”¥ é£Ÿäº‹å…¥åŠ›
# -------------------------

st.header("ğŸ½ é£Ÿäº‹å…¥åŠ›ï¼ˆã‚°ãƒ©ãƒ ã§OKï¼ï¼‰")

selected_food = st.selectbox("é£Ÿã¹ãŸã‚‚ã®ã‚’é¸ã¶", names)
grams = st.number_input("é£Ÿã¹ãŸé‡ï¼ˆgï¼‰", min_value=1, max_value=2000, value=100)

if st.button("ã‚«ãƒ­ãƒªãƒ¼è¨ˆç®—"):
    cal_per_g = next(f["cal"] for f in food_data if f["name"] == selected_food)
    total = cal_per_g * grams
    st.subheader(f"ğŸ‘‰ **{selected_food}ï¼š{total:.1f} kcal**")

    # æ „é¤Šä¸è¶³åˆ†æï¼ˆä»®ï¼‰â†’ ä»Šã¯ç³–è³ª/ã‚¿ãƒ³ãƒ‘ã‚¯è³ª/è„‚è³ªä¾‹ã§ä»£ç”¨
    # æœ¬æ ¼å®Ÿè£…ã¯ã‚ãªãŸãŒé£Ÿæãƒªã‚¹ãƒˆå¢—ã‚„ã—ãŸå¾Œã«æ‹¡å¼µå¯èƒ½
    if cal_per_g < 0.4:
        nutrient_need = "ã‚¿ãƒ³ãƒ‘ã‚¯è³ªä¸è¶³æ°—å‘³ã‹ã‚‚ğŸ’ª"
        suggestion = "é¶èƒ¸è‚‰ãƒ»åµãƒ»ã‚®ãƒªã‚·ãƒ£ãƒ¨ãƒ¼ã‚°ãƒ«ãƒˆã‚’æ¬¡ã®é£Ÿäº‹ã«å…¥ã‚Œã‚ˆã†ï¼"
    elif cal_per_g < 1.0:
        nutrient_need = "é£Ÿç‰©ç¹Šç¶­ãŒè¶³ã‚Šãªã„ã‹ã‚‚ğŸŒ¿"
        suggestion = "ãƒ–ãƒ­ãƒƒã‚³ãƒªãƒ¼ãƒ»ã‚Šã‚“ã”ãƒ»ãƒ¬ã‚¿ã‚¹ãªã©è¿½åŠ ã™ã‚‹ã¨è‰¯ã„ã‚ˆï¼"
    else:
        nutrient_need = "ç³–è³ªã‚’ã—ã£ã‹ã‚Šå–ã‚Œã¦ã‚‹ã­ğŸš"
        suggestion = "æ¬¡ã¯ã‚¿ãƒ³ãƒ‘ã‚¯è³ªå¤šã‚ã®é£Ÿæã‚’çµ„ã¿åˆã‚ã›ã‚‹ã®ãŒæœ€é«˜âœ¨"

    st.write("### ğŸ” æ „é¤Šåˆ†æ")
    st.write(nutrient_need)
    st.write("### ğŸ½ æ¬¡ã®é£Ÿäº‹ã®ãŠã™ã™ã‚")
    st.write(suggestion)

    # -------------------------
    # ğŸ”¥ ã‚³ãƒ¼ãƒã®ã‚³ãƒ¡ãƒ³ãƒˆ
    # -------------------------

    st.write("---")
    st.subheader("ğŸ¤– ä»Šæ—¥ã®ã‚³ãƒ¼ãƒã‚³ãƒ¡ãƒ³ãƒˆ")

    if coach == "å„ªã—ã„ãŠå§‰ã•ã‚“ğŸ’›":
        st.write("ğŸ’› ã‚ˆãé£Ÿã¹ãŸã­ã€œï¼ç„¡ç†ã—ãªãã¦ã„ã„ã‚ˆã€ç”Ÿãã¦ã‚‹ã ã‘ã§å®Œç’§ï¼")
        st.write("ğŸ’› æ¬¡ã®é£Ÿäº‹ã‚‚ä¸€ç·’ã«è€ƒãˆã‚ˆï¼Ÿ")

    elif coach == "å³ã—ã‚ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ¼ğŸ’ª":
        st.write("ğŸ’ª ã¾ã ã¾ã ã ï¼æ¬¡ã¯ã‚¿ãƒ³ãƒ‘ã‚¯è³ªè¿½åŠ ï¼è…¹ç­‹30å›ã„ã‘ã‚‹ãï¼ï¼")
        st.write("ğŸ”¥ ãŒã£ã¤ã ãœï¼ï¼")

    else:  # åŒ»è€…
        st.write("ğŸ‘“ ãµã‚€ã€èˆˆå‘³æ·±ã„ãƒ‡ãƒ¼ã‚¿ã§ã™ã­ã€‚")
        st.write("ğŸ‘“ æ¬¡ã®é£Ÿäº‹ã§ã¯â—‹â—‹ã‚’è¿½åŠ ã™ã‚‹ã¨ã•ã‚‰ã«å®‰å®šã—ã¾ã™ã­ã€‚")

